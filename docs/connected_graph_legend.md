# Connected graph の凡例（表示要素の意味）

このアプリの「Connected graph」は、選択した中心曲（Query）と、その近傍（類似曲）をネットワーク図として表示します。

## ノード（曲）

### 色（ノード種別）
- **オレンジ（#ff8c00）**: Query（サイドバーで選択した中心曲）
- **青（#4c78a8）**: Query の Top-K 類似曲（初期表示の近傍）
- **青緑（#72b7b2）**: 「拡張する」で追加されたノード（探索で増えた近傍）

### 大きさ（ノードサイズ）
- **Query**: 固定（`size = 32`）
- **Top-K 類似曲（青）**: 類似度に応じて拡大（**誇張表示**）
  - 表示中の近傍の **最小類似度〜最大類似度** を `12〜30` に正規化してサイズに反映（単調増加）
  - さらに `t^2` を使って、上位（高類似度）ほど差が見えやすいようにしています
- **拡張ノード（青緑）**: 固定（`size = 10`）

### ラベル / ツールチップ
- **ラベル**: `title` があれば曲名、なければ `song_key`
- **ツールチップ（マウスオーバー）**: `title / artist / year`（あれば） + `song_key`

## エッジ（曲同士のつながり）

### 何を表す？
エッジ（線）は「類似関係」を表します。

- 初期表示: **Query → Top-K 類似曲** のエッジのみ
- 拡張後: 選択したノード → その近傍（`Expand neighbors per click` 件）のエッジが追加

### 太さ
- **太いほど類似度が高い**（`edge.value = similarity` を使って太さがスケーリングされます）
- エッジにマウスを載せると `similarity: 0.xxx` が表示されます

### 色
- エッジ色は基本的に **送信元（from）ノードの色を継承**します（vis-network の既定挙動）
  - Query から伸びるエッジがオレンジ寄りに見えるのはこのためです
  - 拡張ノードから追加されたエッジは、青緑寄りに見えることがあります

### 長さ（見た目の距離）
- **エッジの長さやノード間距離は、類似度の距離を直接表しません**
- レイアウトは物理シミュレーション（Barnes-Hut）で決まり、見やすさのために自動配置されます

## 見やすくするコツ
- ノードや線が多くて見づらい場合は、`Min similarity (graph)` を上げると弱いエッジ（低類似度）が非表示になり、グラフが簡潔になります
- 「拡張する」を押す前に、ノードをクリックして詳細カードで曲を確認すると迷いにくいです

## 実装（参考）
ノード/エッジの色やサイズ、ツールチップは `app/graph.py` で定義しています。
